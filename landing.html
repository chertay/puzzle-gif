---
---
<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Gif Puzzler</title>
    <link rel="stylesheet" type="text/css" href="/puzzler.css" />
    <link rel="import" href="{{ '/s/x-gif.html' | prepend: site.baseurl }}">
  </head>
  <body>
    <!-- <x-gif src="http://i.imgur.com/RY2vTBQ.gif"></x-gif> -->
    <h1>Shitty Game of Gifs</h1>
    <div class ="flex-grid">
    </div>
    <script src="https://code.jquery.com/jquery-1.12.4.js" type="text/javascript"></script>
    <script src="https://code.jquery.com/ui/1.12.0/jquery-ui.js" type="text/javascript"></script>
    <script src="js/drag-n-drop.js" type="text/javascript"></script>
    <script type="text/javascript">

        $(document).ready(ddInit());

        var setUpPage = function(giphy_api_result) {
            // Pull an image URL out of the Giphy API response JSON
            console.log("Giphy API result:");
            console.log(giphy_api_result)
            var gif_url = giphy_api_result['data']['image_url'];

            // Create x-gif tag
            var gif = document.createElement('x-gif');
            gif.setAttribute('src', gif_url);

              var gifs = [];
              var frameLength = 0;

            // HACK: Wait for the gif to be loaded and for the frames to be initialized within <x-gif>:
            setTimeout(function(){
              var frames = gif.controller.playback.element.querySelectorAll('.frame');
              frameLength = frames.length < 20 ? frames.length : 20;
              for(var i = 0; i < frameLength; i++) {
                gifs[i] = document.createElement('x-gif');
                gifs[i].setAttribute('src',gif_url);
              }
              var grid = document.querySelectorAll(".flex-grid")[0];
              for(var i = 0; i < frameLength; i++) {
                var divNode = document.createElement('div');
                divNode.className = "col";
                divNode.setAttribute("data-order", i);
                grid.appendChild(divNode);
              }
            }, 3000);

            setTimeout(function() {
              var sortables = document.querySelectorAll('.col');
              var images = [];
              for ( var i = 0; i < frameLength; i++) {
                  images[i] = gifs[i].controller.playback.element.querySelectorAll('.frame');
              }
              Object.keys(sortables).forEach(function(sq,i){
                  sortables[sq].appendChild(gifs[frameLength - 1 -i]);
                  for ( var y = i; y > 0; y--) {
                    gifs[i].controller.playback.element.removeChild(images[i][y]);
                  }
              });
            }, 5000);
        }

        // Hit the Giphy API and call setUpPage() with the result
        $.ajax({url: "https://api.giphy.com/v1/gifs/random?api_key=dc6zaTOxFJmzC",
                success: setUpPage});

    </script>
  </body>
</html>
